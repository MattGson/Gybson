(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{61:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var r=n(2),a=n(6),o=(n(0),n(75)),i={id:"graphql",title:"Using with GraphQL",sidebar_label:"Using with GraphQL"},s={unversionedId:"graphql",id:"graphql",isDocsHomePage:!1,title:"Using with GraphQL",description:"Gybson is highly suited to building GraphQL apps. It uses DataLoader under",source:"@site/docs/graphql.md",permalink:"/Gybson/docs/graphql",editUrl:"https://github.com/MattGson/Gybson/docs/docs/graphql.md",sidebar_label:"Using with GraphQL",sidebar:"someSidebar",previous:{title:"Filtering",permalink:"/Gybson/docs/where"},next:{title:"About the generated code",permalink:"/Gybson/docs/codegen"}},c=[{value:"Apollo example",id:"apollo-example",children:[]}],l={rightToc:c};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Gybson is highly suited to building GraphQL apps. It uses ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/graphql/dataloader"}),"DataLoader")," under\nthe hood to batch and cache database requests. "),Object(o.b)("p",null,"This allows for deep GraphQL trees to be resolved without an explosion in database request whilst still\nresolving each field independently."),Object(o.b)("p",null,"Other solutions such as eager loading from the root of the tree work for simple apps but are massively\nlimiting in complex data graphs."),Object(o.b)("p",null,"See the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/graphql/dataloader"}),"DataLoader docs"),"  for more details on query efficiency in GraphQL."),Object(o.b)("h2",{id:"apollo-example"},"Apollo example"),Object(o.b)("p",null,"Add a gybson instance to the context."),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Make sure to add a new client instance to the context on every request.\nThis will ensure the cache is clean and no stale data is returned.\nSee ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/graphql/dataloader#caching-per-request"}),"DataLoader")," for more details"))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),"import GybsonClient from './generated';\n\n// attach a client instance to the context\nnew ApolloServer({\n    context: async () => {\n        return {\n            gybson: GybsonClient(),\n        };\n    },\n});\n")),Object(o.b)("p",null,"Then in your resolvers:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),"// resolve a user query\n\nQuery: {\n    user(parent, args, context, info) {\n        return context.gybson.Users.loadOne({ where: { user_id: args.id } });\n    },\n    posts(parent, args, context, info) {\n        return context.gybson.Posts.loadMany({ where: { author_id: parent.author_id } });\n    },\n    comments(parent, args, context, info) {\n         return context.gybson.Comments.loadMany({ where: { post_id: parent.post_id } });\n    }\n}\n")),Object(o.b)("p",null,"Executing the following query results in just 3 database round-trips\nregardless of how many posts or comments are loaded."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-typescript"}),"query {\n    user(id: 1) {\n        user_id\n        name\n        posts {\n            post_id\n            message\n            comments {\n                comment_id\n                message\n            }\n        }\n    }\n}\n \n")))}p.isMDXComponent=!0},75:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),p=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},u=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),d=p(n),u=r,m=d["".concat(i,".").concat(u)]||d[u]||b[u]||o;return n?a.a.createElement(m,s(s({ref:t},l),{},{components:n})):a.a.createElement(m,s({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);